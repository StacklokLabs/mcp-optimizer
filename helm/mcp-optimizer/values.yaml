# Default values for mcp-optimizer
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# MCP Optimizer MCPServer configuration
mcpserver:
  # Name of the MCPServer resource
  name: mcp-optimizer
  
  # Namespace where the MCPServer will be deployed
  namespace: toolhive-system
  
  # Container image configuration
  image:
    # Container registry and image name
    repository: ghcr.io/stackloklabs/mcp-optimizer
    # Image tag (defaults to chart appVersion if not set)
    tag: ""
  
  # Transport configuration for MCP protocol (only streamable-http is supported)
  transport: streamable-http
  
  # Port for the MCP server
  port: 9900
  
  # Target port (required for streamable-http and sse transports)
  targetPort: 9900
  
  # Resource limits and requests for the container
  resources:
    limits:
      cpu: "1000m"
      memory: "2Gi"
    requests:
      cpu: "250m"
      memory: "256Mi"
  
  # Environment variables for mcp-optimizer (used for overrides when using podTemplateSpec)
  # These will be merged with podTemplateSpec env vars if both are defined
  # NOTE: ASYNC_DB_URL and DB_URL are automatically added by the template
  env: []

  # Pod template spec - default configuration with volumes and env vars
  # Values from groupFiltering.allowedGroups and mcpserver.env will be merged into this
  podTemplateSpec:
    spec:
      securityContext:
        fsGroup: 1000
      volumes:
        - name: data
          emptyDir: {}
        - name: tmp
          emptyDir: {}
      containers:
        - name: mcp
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: data
              mountPath: /data
            - name: tmp
              mountPath: /tmp
          env:
            - name: SQLITE_TMPDIR
              value: "/data"
            - name: RUNTIME_MODE
              value: "k8s"
            - name: K8S_ALL_NAMESPACES
              value: "true"
            # MCP_PORT is automatically set by the operator from spec.port
            - name: LOG_LEVEL
              value: "INFO"
            - name: WORKLOAD_POLLING_INTERVAL
              value: "60"
            - name: REGISTRY_POLLING_INTERVAL
              value: "300"
            - name: MAX_TOOLS_TO_RETURN
              value: "8"
            - name: MAX_SERVERS_TO_RETURN
              value: "5"
            - name: HYBRID_SEARCH_SEMANTIC_RATIO
              value: "0.5"
            # ASYNC_DB_URL and DB_URL are added by the template
            # ALLOWED_GROUPS is added by the template if groupFiltering is configured
  
  # Labels to apply to the MCPServer resource
  labels: {}
  
  # Annotations to apply to the MCPServer resource
  annotations: {}

# Service Account configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  
  # Annotations to add to the service account
  annotations: {}
  
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""
  
  # Labels to add to the service account
  labels: {}

# RBAC configuration
rbac:
  # Specifies whether RBAC resources should be created
  create: true
  
  # Rules for the ClusterRole
  rules:
    # Allow reading MCPServer CRDs
    - apiGroups: ["toolhive.stacklok.dev"]
      resources: ["mcpservers"]
      verbs: ["get", "list", "watch"]

# Additional optional configurations
# Group filtering - uncomment and configure to limit which MCP server groups mcp-optimizer can access
# groupFiltering:
#   allowedGroups:
#     - "development"
#     - "production"

# Database configuration
# By default uses SQLite in /tmp (ephemeral storage)
# For production, consider using PostgreSQL or mounting a persistent volume
database:
  # Type: sqlite or postgresql
  type: sqlite
  
  # SQLite configuration (default)
  sqlite:
    # Path to SQLite database file (inside the container)
    # Using /data for ephemeral storage with emptyDir (no persistent volume needed)
    path: /data/mcp_optimizer.db
  
  # PostgreSQL configuration (optional)
  # postgresql:
  #   host: postgres.default.svc.cluster.local
  #   port: 5432
  #   database: mcp_optimizer
  #   username: mcp_optimizer
  #   # Password should be provided via secret
  #   passwordSecretName: mcp-optimizer-db-secret
  #   passwordSecretKey: password

# Persistence configuration for SQLite
persistence:
  # Enable persistence using PVC
  enabled: false
  
  # PVC configuration
  # storageClass: "-"
  accessMode: ReadWriteOnce
  size: 1Gi
  
  # Existing claim name to use
  # existingClaim: ""

# Network policy configuration
networkPolicy:
  # Enable network policies
  enabled: false
  
  # Ingress rules
  ingress: []
  
  # Egress rules
  egress: []

